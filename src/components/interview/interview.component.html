<div
  class="glass w-full max-w-7xl mx-auto rounded-3xl p-4 sm:p-6 md:p-10 flex flex-col min-h-[85vh] animate-fade-in border border-black/10 shadow-2xl shadow-black/10">
  @if (session(); as currentSession) {
  <div class="flex-grow flex flex-col lg:flex-row gap-8 relative">

    <!-- Left Panel: Interviewer Identity & Status -->
    <div class="w-full lg:w-1/3 flex flex-col items-center justify-between relative z-10 order-1 lg:order-1">

      <!-- AI Avatar Container -->
      <div class="flex flex-col items-center mt-2 sm:mt-4 md:mt-10">
        <div class="relative w-40 h-40 sm:w-48 sm:h-48 md:w-56 md:h-56 lg:w-64 lg:h-64 mb-4 sm:mb-6 md:mb-8 group">
          <!-- Pulse Effects -->
          <div
            class="absolute inset-0 rounded-full transition-all duration-500 blur-2xl opacity-40 group-hover:opacity-60"
            [class.bg-gray-500]="isAISpeaking()" [class.bg-gray-600]="isMicOn() && !isAISpeaking()"
            [class.scale-125]="isAISpeaking()"></div>

          <div class="absolute inset-0 rounded-full border-2 border-white/10 scale-110"
            [class.animate-spin-slow]="isAISpeaking()"></div>

          <div class="relative z-10 w-full h-full p-2 rounded-full border border-white/20 glass">
            <img src="https://acetechnologies.com/assets/images/candidates/cb698ebd6.webp" alt="AI Interviewer"
              class="w-full h-full rounded-full object-cover shadow-2xl">
          </div>

          <!-- Status Badge -->
          <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 z-20">
            @if(isAISpeaking()){
            <span
              class="bg-gray-500/90 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg border border-gray-400/50 flex items-center gap-2 whitespace-nowrap animate-pulse">
              <i class="fas fa-wave-square"></i> Speaking...
            </span>
            }
            @else if(isMicOn()){
            <span
              class="bg-gray-600/90 text-white text-xs font-bold px-4 py-1.5 rounded-full shadow-lg border border-gray-500/50 flex items-center gap-2 whitespace-nowrap animate-pulse">
              <i class="fas fa-microphone"></i> Listening...
            </span>
            }
            @else {
            <span
              class="bg-slate-700/90 text-slate-300 text-xs font-bold px-4 py-1.5 rounded-full shadow-lg border border-white/10 flex items-center gap-2 whitespace-nowrap">
              <i class="fas fa-pause"></i> Paused
            </span>
            }
          </div>
        </div>

        <div class="text-center space-y-1">
          <h2 class="text-2xl sm:text-3xl font-bold text-black tracking-tight">Sophia</h2>
          <p class="text-gray-600 font-medium tracking-wide text-xs sm:text-sm uppercase">Senior Technical Recruiter</p>
        </div>
      </div>

      <!-- HUD Stats -->
      <div class="w-full grid grid-cols-2 gap-2 sm:gap-4 mt-4 sm:mt-6 lg:mt-auto">
        <div
          class="glass-card p-2 sm:p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-t-gray-500/50">
          <span class="text-gray-600 text-[10px] sm:text-xs font-bold uppercase tracking-wider mb-1">Time Remaining</span>
          <span class="text-xl sm:text-2xl font-mono font-bold text-black tabular-nums">{{ formatTime(timeLeft()) }}</span>
        </div>
        <div
          class="glass-card p-4 rounded-2xl flex flex-col items-center justify-center border-t-2 border-t-gray-600/50">
          <span class="text-gray-600 text-xs font-bold uppercase tracking-wider mb-1">Status</span>
          <span class="text-sm font-bold text-black uppercase bg-black/5 px-3 py-1 rounded-full">
            {{ isFinishing() ? 'Finalizing' : 'Live' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Vertical Divider (Desktop Only) -->
    <div class="hidden lg:block w-px bg-gradient-to-b from-transparent via-black/10 to-transparent mx-4"></div>

    <!-- Right Panel: Interaction Area -->
    <div class="w-full lg:w-2/3 flex flex-col relative z-0 order-2 lg:order-2">
      @if(isLoading()) {
      <div
        class="flex-grow flex flex-col items-center justify-center glass-card rounded-3xl p-12 text-center border-2 border-dashed border-black/10">
        <div class="relative mb-6">
          <div class="absolute inset-0 bg-black/30 blur-xl rounded-full animate-ping"></div>
          <i class="fas fa-wifi fa-3x text-gray-400 relative z-10"></i>
        </div>
        <h3 class="text-3xl font-bold text-black mb-2">Establishing Connection</h3>
        <p class="text-gray-600">Securely connecting to Neural Voice Engine...</p>
      </div>
      } @else if(isFinishing()) {
      <div
        class="flex-grow flex flex-col items-center justify-center glass-card rounded-3xl p-12 text-center border-2 border-dashed border-black/10 relative overflow-hidden group">

        <!-- Background Ambient Effect -->
        <div class="absolute inset-0 bg-black/5 blur-[100px] animate-pulse"></div>

        <!-- Animated Icon Container -->
        <div class="mb-10 relative w-32 h-32 flex items-center justify-center">
          <!-- Outer Ring -->
          <div class="absolute inset-0 border-4 border-black/20 rounded-full animate-[spin_4s_linear_infinite]">
          </div>
          <div class="absolute inset-0 border-t-4 border-black rounded-full animate-[spin_3s_linear_infinite]"></div>

          <!-- Middle Ring -->
          <div
            class="absolute inset-4 border-4 border-black/20 rounded-full animate-[spin_3s_linear_infinite_reverse]">
          </div>
          <div
            class="absolute inset-4 border-b-4 border-black rounded-full animate-[spin_3s_linear_infinite_reverse]">
          </div>

          <!-- Inner Brain Icon -->
          <div class="relative z-10 animate-bounce-gentle">
            <i
              class="fas fa-brain text-5xl bg-gradient-to-br from-black to-gray-400 bg-clip-text text-transparent filter drop-shadow-lg"></i>
          </div>

          <!-- Scanning Line -->
          <div class="absolute inset-0 w-full h-1 bg-black/50 blur-sm animate-scan"></div>
        </div>

        <!-- Dynamic Text Area -->
        <h3 class="text-4xl font-bold text-black mb-4 tracking-tight animate-fade-in-up">
          Finalizing Report
        </h3>

        <!-- Animated Processing Steps (CSS only trick for now) -->
        <div class="h-6 overflow-hidden relative w-full max-w-md">
          <div class="animate-text-slide flex flex-col items-center gap-2 text-gray-600 font-medium font-mono text-sm">
            <span>Analyzing tonal patterns...</span>
            <span>Calculating technical accuracy...</span>
            <span>Generating code feedback...</span>
            <span>Compiling executive summary...</span>
          </div>
        </div>
      </div>
      } @else {

      <!-- Active Question Display -->
      <div class="flex-grow mb-6 relative group">
        <div
          class="absolute -inset-1 bg-gradient-to-r from-black/10 to-black/10 rounded-2xl blur opacity-0 group-hover:opacity-100 transition duration-500">
        </div>
        <div
          class="glass-card rounded-2xl p-8 h-full flex flex-col border border-black/10 bg-white/40 relative z-10">
          <div class="flex items-center gap-3 mb-4">
            <span class="w-2 h-2 rounded-full bg-black animate-pulse"></span>
            <p class="text-xs text-black font-bold tracking-widest uppercase">Current Question</p>
          </div>

          <p class="text-lg sm:text-xl md:text-2xl lg:text-3xl font-semibold leading-relaxed text-gray-900 flex-grow animate-fade-in">
            {{ currentQuestionText() }}
          </p>

          <!-- Audio visualizer bars (fake) styling -->
          @if(isAISpeaking()) {
          <div class="flex gap-1 h-8 items-end mt-4 opacity-50">
            <div class="w-1 bg-black rounded-full animate-bounce" style="animation-delay: 0s; height: 40%"></div>
            <div class="w-1 bg-black rounded-full animate-bounce" style="animation-delay: 0.1s; height: 70%"></div>
            <div class="w-1 bg-black rounded-full animate-bounce" style="animation-delay: 0.2s; height: 100%"></div>
            <div class="w-1 bg-black rounded-full animate-bounce" style="animation-delay: 0.1s; height: 60%"></div>
            <div class="w-1 bg-black rounded-full animate-bounce" style="animation-delay: 0.3s; height: 80%"></div>
          </div>
          }
        </div>
      </div>

      <!-- Transcript Area -->
      <div class="relative">
        <div class="flex justify-between items-center mb-3">
          <label class="text-xs text-black font-bold uppercase tracking-wider flex items-center gap-2">
            <i class="fas fa-terminal"></i> Live Transcript
          </label>
          @if(isMicOn() && !isAISpeaking()) {
          <span class="text-[10px] text-gray-500 animate-pulse">Recording...</span>
          }
        </div>

        <div class="relative group">
          <div
            class="absolute -inset-0.5 bg-gradient-to-r from-black/20 to-black/20 rounded-2xl blur opacity-20 group-focus-within:opacity-100 transition duration-500">
          </div>
          <textarea rows="5" readonly [value]="userTranscript()"
            placeholder="Speak clearly, your response is being transcribed..."
            class="relative w-full glass bg-white/40 border border-black/10 rounded-xl px-6 py-5 text-gray-900 placeholder-gray-600 focus:outline-none focus:ring-0 text-lg font-light leading-relaxed resize-none font-sans"></textarea>
        </div>
      </div>

      <!-- Actions -->
      <div class="mt-4 sm:mt-8 flex justify-end">
        <button (click)="finishInterview()" [disabled]="isFinishing()"
          class="group relative bg-black/10 hover:bg-black text-black hover:text-white border border-black/50 hover:border-black font-bold py-2 sm:py-3 px-4 sm:px-8 rounded-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base">
          <span class="flex items-center gap-2">
            <i class="fas fa-stop-circle text-lg sm:text-xl"></i>
            <span>End Session</span>
          </span>
        </button>
      </div>
      }
    </div>
  </div>
  } @else {
  <div class="flex-grow flex flex-col items-center justify-center text-center space-y-6">
    <div
      class="w-20 h-20 rounded-full border-4 border-t-black border-r-black border-b-transparent border-l-transparent animate-spin">
    </div>
    <p class="text-gray-600 text-xl font-light">Initializing secure environment...</p>
  </div>
  }
</div>