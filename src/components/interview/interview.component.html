<div class="glass w-full max-w-6xl mx-auto rounded-2xl p-8 flex flex-col min-h-[80vh]">
  @if (session(); as currentSession) {
  <div class="flex-grow flex flex-col md:flex-row gap-8">
    <!-- Left Panel: Interviewer & Info -->
    <div class="w-full md:w-1/3 flex flex-col items-center">
      <div class="relative w-48 h-48 mb-4">
        <div class="absolute inset-0 rounded-full transition-all duration-500"
          [class.animate-pulse]="isAISpeaking() || isMicOn()" [class.scale-105]="isAISpeaking()"
          [class.bg-blue-500]="isAISpeaking()" [class.bg-green-500]="isMicOn() && !isAISpeaking()"></div>
        <img src="https://acetechnologies.com/assets/images/candidates/cb698ebd6.webp" alt="AI Interviewer"
          class="w-48 h-48 rounded-full border-4 border-slate-700 relative z-10">
      </div>
      <h2 class="text-xl font-semibold text-white">AI Interviewer</h2>
      <p class="text-slate-400">Senior Technical Interviewer</p>
      @if(isMicOn() && !isAISpeaking()){
      <span class="mt-2 text-green-400 text-sm font-medium animate-pulse">
        <i class="fas fa-microphone mr-1"></i> Listening...
      </span>
      }
      @if(isAISpeaking()){
      <span class="mt-2 text-blue-400 text-sm font-medium animate-pulse">
        <i class="fas fa-volume-up mr-1"></i> Speaking...
      </span>
      }

      <div class="mt-auto w-full space-y-4 pt-8">
        <div class="flex justify-between items-center glass-card p-4 rounded-xl border border-white/5">
          <span class="text-slate-300 font-medium">Time Left</span>
          <span class="text-lg font-bold text-white tabular-nums">{{ formatTime(timeLeft()) }}</span>
        </div>
        <div class="flex justify-between items-center glass-card p-4 rounded-xl border border-white/5">
          <span class="text-slate-300 font-medium">Status</span>
          <span class="text-sm font-bold text-white uppercase">{{ isFinishing() ? 'FINISHING' : 'IN PROGRESS' }}</span>
        </div>
      </div>
    </div>

    <!-- Right Panel: Question & Answer -->
    <div class="w-full md:w-2/3 flex flex-col">
      @if(isLoading()) {
      <div
        class="flex-grow flex flex-col items-center justify-center glass-card rounded-2xl p-8 text-center border border-white/5">
        <i class="fas fa-wifi fa-3x text-blue-400 mb-4 animate-ping"></i>
        <h3 class="text-2xl font-semibold text-white">Connecting to Live Session...</h3>
        <p class="text-slate-400 mt-2">Please allow microphone access.</p>
      </div>
      } @else if(isFinishing()) {
      <div
        class="flex-grow flex flex-col items-center justify-center glass-card rounded-2xl p-8 text-center border border-white/5">
        <i class="fas fa-cogs fa-3x fa-spin text-blue-400 mb-4"></i>
        <h3 class="text-2xl font-semibold text-white">Finalizing Report...</h3>
        <p class="text-slate-400 mt-2">Compiling your feedback and calculating your score.</p>
      </div>
      } @else {
      <div class="flex-grow flex flex-col glass-card rounded-2xl p-8 animate-fade-in border border-white/5">
        <p class="text-sm text-blue-300 font-semibold mb-2">AI INTERVIEWER</p>
        <p class="text-2xl font-semibold leading-relaxed text-slate-100 flex-grow min-h-[100px]">
          {{ currentQuestionText() }}
        </p>
      </div>
      <div class="mt-6">
        <label class="text-sm text-green-300 font-semibold mb-2 block">YOUR RESPONSE (LIVE TRANSCRIPT)</label>
        <textarea rows="6" readonly [value]="userTranscript()" placeholder="Your live speech will appear here..."
          class="w-full glass-card border border-white/10 rounded-xl px-6 py-4 text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all text-lg"></textarea>
      </div>
      <div class="mt-4 flex justify-end">
        <button (click)="finishInterview()" [disabled]="isFinishing()"
          class="bg-red-600 hover:bg-red-700 disabled:bg-slate-600 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300">
          End Interview
        </button>
      </div>
      }
    </div>
  </div>
  } @else {
  <div class="text-center">
    <p class="text-slate-400">Loading interview session...</p>
  </div>
  }
</div>